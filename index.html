<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>Cleaning Gritty Data to tell a story in the News Room or the Board Room</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">
	
	<!-- Extension CSS files go here. Remove or add as needed. -->
	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/scraperwiki.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="themes/transition/horizontal-slide.css">
	
	<!-- Required Modernizr file -->
	<script src="modernizr.custom.js"></script>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->

<section class="slide title">
	<hgroup>
		<h1>Cleaning Gritty Data to tell a story in the News Room or the Board Room</h1>
		<h2>With <a href="http://www.thomaslevine.com">Thomas Levine</a> from <a href="https://scraperwiki.com/">ScraperWiki</a></h2>
	</hgroup>
	<p style="float: right; font-size: 0.5em;" id="slide-deck-href"></p>
        <script>document.getElementById('slide-deck-href').innerHTML=document.location.href.split('#')[0];</script>
	<img src="themes/style/scraperwiki/tractor-transparent.png" alt="A wheel-tractor scraper">
</section>

<section class="slide">
	<h2>ScraperWiki</h2>
	<ul>
		<li>Web-based platform</li>
		<li>Write scripts to get, clean and analyse data sets (<a href="http://blog.okfn.org/2012/03/09/from-cms-to-dms-c-is-for-content-d-is-for-data/">data hub</a>)</li>
		<li>Simply schedule scripts</li>
		<li>Reuse data via a web SQL API<li>
	</ul>
</section>

<section class="slide">
	<h2>Outline</h2>
	<ol>
		<li>Cleaning data without computers (not technical)</li>
		<li>Tricks for cleaning data with computers (super technical)</li>
		<li>Telling a story (not technical)</li>
	</ol>
</section>

<section class="slide">
	<h1>Cleaning data without computers</h1>
</section>

<section class="slide">
	<h2>New Orleans Wetlands</h2>
	<p><a href="http://healthygulf.org/">The Gulf Restoration Network</a> on <a href="http://healthygulf.org/our-work/wetlands/wetlands-overview">wetlands</a></p>
	<blockquote cite="http://healthygulf.org/our-work/wetlands/wetlands-overview">
		The [Gulf Restoration Network] works to protect wetlands from reckless development,
		destructive logging practices, and harmful U.S. Army Corps of Engineers projects and policies.
	</blockquote>
	<p>More specifically</p>
	<ul>
		<li>You apply for a permit build on the wetlands in the United States.</li>
		<li>The Army Corps of Engineers can approve permits that meet certain criteria.</li>
		<li>I have no idea how the Army got this job.</li>
		<li>The Army, understandably, doesn't scrutinize permits as much as the Gulf Restoration Network would like.</li>
	</ul>
</section>

<section class="slide no-footer" style="height: 100%;">
	<h2>New Orleans Wetlands</h2>
	<p>Applications get posted to a <a href="http://www.mvn.usace.army.mil/ops/regulatory/publicnotices.asp">website</a>.</p>
	<img src="images/army404.png" alt="Screenshot of the Army Corps of Engineers website">
</section>

<section class="slide">
	<h2>New Orleans Wetlands</h2>
	<p>Applications look like this.</p>
	<img src="images/public-notice.png" alt="Excerpt of a public notice regarding a New Orleans wetland development" width="70%" >
</section>

<section class="slide">
	<h2>New Orleans Wetlands</h2>
	<p>How the Gulf Restoration Network uses these</p>
	<ol>
		<li>Read the public notices regularly.</li>
		<li>Identify applications for inappropriate things (like shopping malls).</li>
		<li>Contact 
	</ol>
	<a href="http://healthygulf.org/images/who_we_are/staff/Scott_headshot2.jpg">
		<img src="images/scott.png" style="float: left;">
	</a>
	<div>
		<p>In the past, <a href="http://healthygulf.org/images/who_we_are/staff/Scott_headshot2.jpg">Scott</a> has had to do this manually. But he doesn't really have time for that.</p>
		<p>We're using a computer program to make the first two of these steps easier.</p>
	</div>
</section>

<section class="slide">
	<h2>New Orleans Wetlands</h2>
	<p>My script extracts this information.</p>
	<img src="images/highlighted-public-notice.png" alt="Highlighted excerpt of a public notice regarding a New Orleans wetland development" width="70%" >
</section>

<section id="analog-title" class="slide">
	<h1>Analog data-cleaning</h1>
</section>
<section id="analog-0.1" class="slide">
	<img src="images/wetlands/IMAG0051.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-0.2" class="slide">
	<img src="images/wetlands/IMAG0052.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-0.3" class="slide">
	<img src="images/wetlands/IMAG0053.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-1.1" class="slide">
	<img src="images/wetlands/IMAG0054.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-1.2" class="slide">
	<img src="images/wetlands/IMAG0056.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-1.3" class="slide">
	<img src="images/wetlands/IMAG0057.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.0" class="slide">
	<img src="images/wetlands/IMAG0058.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.1.1" class="slide">
	<img src="images/wetlands/IMAG0059.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.1.2" class="slide">
	<img src="images/wetlands/IMAG0060.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.1.3" class="slide">
	<img src="images/wetlands/IMAG0061.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.1.4" class="slide">
	<img src="images/wetlands/IMAG0062.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.2" class="slide">
	<img src="images/wetlands/IMAG0063.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-2.3" class="slide">
	<img src="images/wetlands/IMAG0064.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-3.1" class="slide">
	<!-- Retrieve from file cabinet. -->
	<img src="images/wetlands/IMAG0065.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-3.2" class="slide">
	<!-- Move to the table. -->
	<img src="images/wetlands/IMAG0066.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-3.3" class="slide">
	<!-- Transcribe. -->
	<img src="images/wetlands/IMAG0067.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="analog-4" class="slide">
	<img src="images/wetlands/IMAG0069.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>

<section id="digital-title" class="slide">
	<h1>Digital data-cleaning</h1>
</section>
<section id="digital-0.1" class="slide">
	<img src="images/wetlands/IMAG0051.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-0.2" class="slide">
	<img src="images/wetlands/IMAG0052.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-0.3" class="slide">
	<img src="images/wetlands/IMAG0053.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-1.1" class="slide">
	<img src="images/wetlands/IMAG0054.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-1.2" class="slide">
	<img src="images/wetlands/IMAG0056.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-1.3" class="slide">
	<img src="images/wetlands/IMAG0057.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.0" class="slide">
	<img src="images/wetlands/IMAG0058.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.1.1" class="slide">
	<img src="images/wetlands/IMAG0059.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.1.2" class="slide">
	<img src="images/wetlands/IMAG0060.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.1.3" class="slide">
	<img src="images/wetlands/IMAG0061.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.1.4" class="slide">
	<img src="images/wetlands/IMAG0062.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.2" class="slide">
	<img src="images/wetlands/IMAG0063.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-2.3" class="slide">
	<img src="images/wetlands/IMAG0064.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-3.1" class="slide">
	<!-- Retrieve from file cabinet. -->
	<img src="images/wetlands/IMAG0065.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-3.2" class="slide">
	<!-- Move to the table. -->
	<img src="images/wetlands/IMAG0066.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-3.3" class="slide">
	<!-- Transcribe. -->
	<img src="images/wetlands/IMAG0067.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>
<section id="digital-4" class="slide">
	<img src="images/wetlands/IMAG0069.jpg" alt="Sketch on paper of the permit application data-cleaning process">
</section>

<section class="slide">
	<h2>Dividing labor</h2>
	<p>Complex jobs become simple and easy when we divide them like this.</p>
	<ul>
		<li>Write parts at a time.</li>
		<li>Some parts analog, some parts digital</li>
		<li>Multiple teams/people can work in parallel.</li>
	</ul>
</section>

<section class="slide">
	<h1>Abrupt transition</h1>
</section>

<section class="slide">
	<h1>Tricks for cleaning data with computers</h1>
</section>

<section class="slide">
	<h1>XML/HTML</h1>
</section>

<section class="slide">
	<h2>Use an XML/HTML parser</h2>
	<ul>
		<li>R: XML</li>
		<li>Python: lxml, BeautifulSoup</li>
		<li>C#: XmlDocument, XmlReader</li>
		<li>VBA: XmlDocument, XmlReader</li>
		<li>Java: Java API for XML Processing (JAXP)</li>
		<li>php: SimpleXML, XML Parser, simple_html_dom</li>
		<li>Ruby: Nokogiri</li>
	</ul>
</section>

<section class="slide">
	<h2>Or not</h2>
	<pre><code>
# UK Phone number
/(\+44[0-9 -]{10,15})/

# United States postal code
/([0-9]{5})-?([0-9]{4})?/

# URL
/(https?:\/\/[^ "]+)[ "]/

# ISBN
/([0-9X-]{10,13})/
</code></pre>
</section>

<section class="slide">
	<h2>XPath or CSS?</h2>
	<p>CSS for HTML, normally.</p>
	<ul>
		<li>Faster</li>
		<li>More people know it.</li>
		<li>CSS is normally shorter.</li>
	</ul>
	<p>XPath for more power. For example, select divs that contain tables.</p>
	<pre><code>//div[table[@class="bacon"]]</code></pre>
	<p>XPath for non-HTML</p>
</section>

<section class="slide">
	<h1>Python tricks</h1>
</section>

<section class="slide">
	<h2>Quick search</h2>
	<p>Removing spaces and make lowercase before searching messy text</p>
	<pre><code>
'brains' in ''.join(messy_ocr_text.split()).lower()
</code></pre>
</section>

<section class="slide">
	<h2>unidecode</h2>
	<pre><code>
import unidecode
unidecode.unidecode(weirdly_encoded_text)
</pre></code>
</section>

<section class="slide">
	<img src="images/inspect-request.png" alt="Screenshot of chrome browser element inspector" style="float: left; width: 47%;">
	<pre style="float: right; width: 47%; font-size: 0.5em;"><code>
import requests
url = 'http://www.ncr.org.za/register_of_registrants/cp.php'
params = {
    'Registered': 'Registered',
    'name': '',
    'town': '',
    'regnum': '',
}
print requests.post(url, params).text
</pre></code>
<!-- <a href="https://scraperwiki.com/scrapers/ncr5">https://scraperwiki.com/scrapers/ncr5</a> -->
</section>

<section class="slide">
	<h1>Shell tricks</h1>
</section>

<section class="slide">
	<h2>Quick search</h2>
	<p>Removing spaces and make lowercase before searching messy text</p>
	<pre><code>
cat messy_ocr_text.txt | tr -d\  | tr '[A-Z]' '[a-z]' |grep brains
</code></pre>
</section>

<section class="slide">
	<h2>Union of CSV files</h2>
	<pre><code>
# Given a directory with a bunch of CSV files with identical schemas.
head -n1 1.csv > combined.csv
for csv in *.csv
  do
  sed 1d $csv >> combined.csv
done
</pre></code>
</section>

<section class="slide">
	<h2>Converting PDF to other formats</h2>
	<ul>
		<li>pdftohtml</li>
		<li>pdftotext</li>
		<li>pdfimages</li>
		<li>inkscape</li>
	</ul>
</section>

<section class="slide">
	<h1>General tricks</h1>
</section>

<section class="slide">
	<h2>CSV/JSON good. Database better.</h2>
	<p>CouchDB. Relax.</p>
	<p><a href="http://www.dumptruck.io">DumpTruck</a>. Relax with SQLite.</p>
	<pre><code>
import dumptruck
dt = dumptruck.DumpTruck()
dt.insert({"payload": "10 tons"})
</code></pre>
</section>

<section class="slide">
	<h2>Write tests.</h2>
	<ul>
		<li>Shell: <a href="http://www.urchin.sh">urchin</a></li>
		<li>Node: mocha, should.js</li>
		<li>R: <a href="http://">testthat</a></li>
		<li>Python: <a href="http://">nose</a></li>
	</ul>
</section>

<section class="slide">
	<h2>Manual intervention</h2>
	<pre><code>
# List bad pages here
MALFORMED_PAGES = {
    ('FooBar-August 05, 2012 1234567890.pdf', 67),
    ('FooBar-September 02, 2012 1234567890.pdf', 34),
}

# ...

# Somewhere else in the code
if (filename, int(page.attrib['number'])) in MALFORMED_PAGES:
    warnings.warn("I'm skipping page %d because it is marked as malformed." % int(page.attrib['number']), UserWarning)
else:
    do(something)
    blah.blah('blah')
</pre></code>
</section>


<section class="slide">
	<h1>Telling a story</h1>
	<!-- You don't need to know anything as fancy as what I just told you. -->
</section>

<section class="slide">
	<h1>You don't need to know what you're doing.</h1>
</section>

<section class="slide">
	<h2>Wetlands output</h2>
	<p>Does the public notice contain the phrase "Section 404"?</p>
	<pre><code># This is Python code
'section404' in rawtext.replace(' ', '').lower()
</code></pre>
</section>

<section class="slide">
	<h2>Finding money in papers</h2>
<pre><code>pdftotext file0283.pdf
cat file0283.txt | tr -d\  | grep -H $[a-z,.]+</code></pre> 
</section>

<section class="slide">
	<h2></h2>
	<p></p>
	<pre><code>
</code></pre>
</section>

<section class="slide">
	<h2>Conclusionary Conclusion</h2>
</section>

<section class="slide">
	<h1><span style="font-size: 4em;">!</span></h1>
	<!-- End -->
</section>

<!-- Extra slides -->
<section class="slide">
	<img src="images/workshop-outline-1.png" alt="">
</section>

<section class="slide">
	<img src="images/workshop-outline-2.png" alt="">
</section>

<section class="slide">
	<img src="images/workshop-outline-3.png" alt="">
</section>

<section class="slide">
	<img src="images/workshop-outline-4.png" alt="">
</section>

<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="jquery-1.7.2.min.js"></script>
<script src="core/deck.core.js"></script>

<!-- Style JS file -->
<script src="themes/style/scraperwiki.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="core/deck.core.js"></script>
<script src="extensions/hash/deck.hash.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/scale/deck.scale.js"></script>

<!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.thomaslevine.com/" : "http://piwik.thomaslevine.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 10);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://piwik.thomaslevine.com/piwik.php?idsite=10" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>
</body>
</html>
